function getCurrentUser(){return currentUser}function initApp(){if(!isInitialized)firebase.auth().onAuthStateChanged(function(n){n?(n.getIdToken().then(function(n){idToken=n}),currentUser=n):(logout(),idToken=null,currentUser=null);isInitialized=!0},function(n){currentUser=null;console.log(n)})}function isEmpty(n){return!n||0===n.length||n==="0"}function logout(){firebase.auth().signOut().then(function(){onLogout()},function(){onLogout()})}function onLogout(){document.cookie="token=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;";var t=trimSlashes(window.location.href.split(/[?#]/)[0]),n=trimSlashes(window.location.origin);t!==n&&(window.location.href=n)}function trimSlashes(n){return n.replace(/\/+$/g,"")}function deleteQuestion(n,t){$.ajax({url:"DeleteVotingQuestion",data:{id:n,qid:t},type:"POST",datatype:"json",beforeSend:function(n){n.setRequestHeader("Authorization",idToken)},success:function(){location.reload()}})}function editQuestion(n){$("#modalQuestionOk").off("click").on("click",function(){saveQuestion(n.votingId,n.index)});$("#newQuestionTitle").val(n.text);$("#newQuestionDescription").val(n.description);$("#questionType").val(n.type);n.type!=="1"&&($("#minNoAnswers").val(n.minNumAnswers),$("#maxNoAnswers").val(n.maxNumAnswers),$("#minNoAnswers").parent().show(),$("#maxNoAnswers").parent().show());$("#answersTable .answerOption").not(".hide").each(function(){$(this).detach()});$.each(n.answerOptions,function(n,t){var i=$("#answersTable").find("tr.hide").clone(!0).removeClass("hide");i.addClass("answer-line");i.children("td.answerOptionText").text(t.answer);i.children("td.answerOptionDescription").text(t.description);$("#answersTable").find("table").append(i)});$("#newQuestionModal").modal()}function saveQuestion(n,t){var f,e;$("#modalQuestionOk").text("Speichere...");$("#modalQuestionOk").addClass("disabled");var o=$("#newQuestionDescription").val(),s=$("#newQuestionTitle").val(),h=parseInt($("#questionType").val()),i=firebase.auth().currentUser,r=[],u=[];$("#answersTable .answerOption").not(".hide").each(function(){r.push($(this).find("td.answerOptionText").text());u.push($(this).find("td.answerOptionDescription").text())});f=parseInt($("#minNoAnswers").val());e=parseInt($("#maxNoAnswers").val());i&&i.getIdToken(!0).then(function(i){$.post({url:"UpdateVotingQuestion",data:{id:n,qid:t,title:s,desc:o,type:h,answers:r,answerDescriptions:u,minNumAnswers:f,maxNumAnswers:e},beforeSend:function(n){n.setRequestHeader("Authorization",i)},success:function(){$("#newQuestionModal").modal("hide")}})})}function grantRegistration(n,t){var i=firebase.auth().currentUser;i&&i.getIdToken(!0).then(function(i){$.post({url:"../Registration/GrantRegistration",data:{rid:n},beforeSend:function(n){n.setRequestHeader("Authorization",i)},success:function(){updateRegistrations(t)}})})}function denyRegistration(n,t){var i=firebase.auth().currentUser;i&&i.getIdToken(!0).then(function(i){$.post({url:"../Registration/DenyRegistration",data:{rid:n},beforeSend:function(n){n.setRequestHeader("Authorization",i)},success:function(){updateRegistrations(t)}})})}function showCompletedRegistrations(n){var o=$("#grantedRegistrationsList"),i,r,u,t,f,e;for(o.empty(),i=$("#deniedRegistrationsList"),i.empty(),r=0,u=0,t=0;t<n.length;t++)f=n[t],e='<div style="margin:0 1rem;border-bottom:1px solid #DCE4E7">'+f.voterName+"<\/div>",f.decision===1?(o.append(e),r++):(i.append(e),u++);$("#grantedRegistrationsBadge").text(r);$("#deniedRegistrationsBadge").text(u)}function updateRegistrations(n){$.ajax({url:"../Registration/GetRegistrations",data:{votingId:n},type:"GET",datatype:"json",beforeSend:function(n){n.setRequestHeader("Authorization",idToken)},success:function(t){showRegistrations(t,n)}});$.ajax({url:"../Registration/GetCompletedRegistrations",data:{votingId:n},type:"GET",datatype:"json",beforeSend:function(n){n.setRequestHeader("Authorization",idToken)},success:function(n){showCompletedRegistrations(n)}})}function showRegistrations(n,t){var r,u,i;for($("#openRegistrationsList").removeClass("openRegistrationItem"),r=0;r<n.length;r++)u=n[r],i='<div style="display: flex; margin: 0 1rem;border-bottom: 1px solid #DCE4E7;" class="openRegistrationItem"><div style="flex:1;margin-right:1rem">'+u.voterName+"<\/div>",i+='<div style="align-self: flex-end;cursor:pointer;color:#657f8C" onclick="grantRegistration(\''+u.registrationId+"', '"+t+'\')"><i class="material-icons">add_circle_outline<\/i><\/div>',i+='<div style="align-self: flex-end;cursor:pointer;color:#657f8C" onclick="denyRegistration(\''+u.registrationId+"', '"+t+'\')"><i class="material-icons mx-1">remove_circle_outline<\/i><\/div>',i+='<div style="align-self: flex-end;cursor:pointer;color:#657f8C"><i class="material-icons">info<\/i><\/div><\/div>',$(i).insertBefore("#openRegistrationsDivider");$("#openRegistrationsBadge").text(n.length)}function invite(n){var t=firebase.auth().currentUser,i;t&&(i=["michfasch@gmx.at"],t.getIdToken(!0).then(function(t){$.post({url:"SendInvitationMail",data:{votingId:n,addresses:i},beforeSend:function(n){n.setRequestHeader("Authorization",t)},success:function(){}})}))}function setupOverview(n){$(document).on("click",".dropdown-menu",function(n){n.stopPropagation()});updateRegistrations(n);$(".answerOptionText").click(function(){$(this).text()==="..."&&document.execCommand("selectAll",!1,null)});$(".answerOptionDescription").click(function(){$(this).text()==="..."&&document.execCommand("selectAll",!1,null)});$("#modalQuestionOk").off("click").on("click",function(){saveQuestion(n,0)});$(window).on("scroll",blinkOnScroll);$("#questionType").change(function(){$("#questionType").val()==="1"?($("#minNoAnswers").parent().hide(),$("#maxNoAnswers").parent().hide()):($("#minNoAnswers").parent().show(),$("#maxNoAnswers").parent().show())});$(".table-add").click(function(){var n=$("#answersTable").find("tr.hide").clone(!0).removeClass("hide table-line");n.addClass("answer-line");$("#answersTable").find("table").append(n)});$(".table-remove").click(function(){$(this).parents("tr.answer-line").detach()});$(".table-up").click(function(){var n=$(this).parents("tr");n.index()!==1&&n.prev().before(n.get(0))});$(".table-down").click(function(){var n=$(this).parents("tr");n.next().after(n.get(0))})}function blinkOnScroll(){var n=$(window).height()*1.1,t=$(window).scrollTop();$(".blinkOnScroll:not(.animated)").each(function(){var i=$(this),r=i.offset().top;t+n>r&&(i.data("timeout")?window.setTimeout(function(){i.addClass("animated blinky")},parseInt(i.data("timeout"),10)):i.addClass("animated blinky"))});$(".blinkOnScroll.animated").each(function(){var i=$(this),r=i.offset().top;t+n<r&&$(this).removeClass("animated blinky")})}function createQuestion(n){$("#newQuestionTitle").val("");$("#newQuestionDescription").val("");$("#newQuestionModal").modal();$("#modalQuestionOk").off("click").on("click",function(){saveQuestion(n,0)})}var config={apiKey:"AIzaSyDM8e5m6ToGxu5MZPpUeEYOkypSY1_j0PY",authDomain:"stunning-lambda-162919.firebaseapp.com",databaseURL:"https://stunning-lambda-162919.firebaseio.com",storageBucket:"stunning-lambda-162919.appspot.com",messagingSenderId:"576087239560",projectId:"stunning-lambda-162919"},app=firebase.apps.length===0?firebase.initializeApp(config):firebase.app(),currentUser=null,idToken=null,isInitialized=!1;