function isEmpty(n){return!n||0===n.length||n==="0"}function deleteQuestion(n,t){$.ajax({url:"DeleteVotingQuestion",data:{id:n,qid:t},type:"POST",datatype:"json",success:function(){location.reload()}})}function editQuestion(n){$("#modalQuestionOk").off("click").on("click",function(){saveQuestion(n.votingId,n.index)});$("#newQuestionTitle").val(n.text);$("#newQuestionDescription").val(n.description);$("#questionType").val(n.type);n.type!=="1"&&($("#minNoAnswers").val(n.minNumAnswers),$("#maxNoAnswers").val(n.maxNumAnswers),$("#minNoAnswers").parent().show(),$("#maxNoAnswers").parent().show());$("#answersTable .answerOption").not(".hide").each(function(){$(this).detach()});$.each(n.answerOptions,function(n,t){const i=$("#answersTable").find("tr.hide").clone(!0).removeClass("hide");i.addClass("answer-line");i.children("td.answerOptionText").text(t.answer);i.children("td.answerOptionDescription").text(t.description);$("#answersTable").find("table").append(i)});$("#newQuestionModal").modal()}function saveQuestion(n,t){$("#modalQuestionOk").text("Speichere...");$("#modalQuestionOk").addClass("disabled");const u=$("#newQuestionDescription").val(),f=$("#newQuestionTitle").val(),e=parseInt($("#questionType").val()),i=[],r=[];$("#answersTable .answerOption").not(".hide").each(function(){i.push($(this).find("td.answerOptionText").text());r.push($(this).find("td.answerOptionDescription").text())});const o=parseInt($("#minNoAnswers").val()),s=parseInt($("#maxNoAnswers").val());$.post({url:"UpdateVotingQuestion",data:{id:n,qid:t,title:f,desc:u,type:e,answers:i,answerDescriptions:r,minNumAnswers:o,maxNumAnswers:s},success:function(){$("#newQuestionModal").modal("hide")}})}function grantRegistration(n,t){$.post({url:"../Registration/GrantRegistration",data:{rid:n},success:function(){updateRegistrations(t)}})}function denyRegistration(n,t){$.post({url:"../Registration/DenyRegistration",data:{rid:n},success:function(){updateRegistrations(t)}})}function showCompletedRegistrations(n){const i=$("#grantedRegistrationsList");i.empty();const r=$("#deniedRegistrationsList");r.empty();let u=0,f=0;for(var t=0;t<n.length;t++){const e=n[t],o=`<div class="m-0 px-3 border-bottom">${e.voterName}</div>`;e.decision===1?(i.append(o),u++):(r.append(o),f++)}$("#grantedRegistrationsBadge").text(u);$("#deniedRegistrationsBadge").text(f)}function updateRegistrations(n){$.ajax({url:"../Registration/GetRegistrations",data:{votingId:n},type:"POST",datatype:"json",success:function(t){showRegistrations(t,n)}});$.ajax({url:"../Registration/GetCompletedRegistrations",data:{votingId:n},type:"POST",datatype:"json",success:function(n){showCompletedRegistrations(n)}})}function showRegistrations(n,t){$("#openRegistrationsList").removeClass("openRegistrationItem");for(let i=0;i<n.length;i++){const r=n[i],u=`<div class="d-flex mx-3 my-0 border-bottom openRegistrationItem"><div style="flex:1;margin-right:1rem">${r.voterName}</div>
`+`<div style="align-self: flex-end;cursor:pointer;color:#657f8C" onclick="grantRegistration('${r.registrationId}', '${t}')"><i class="material-icons">add_circle_outline</i></div>
`+`<div style="align-self: flex-end;cursor:pointer;color:#657f8C" onclick="denyRegistration('${r.registrationId}', '${t}')"><i class="material-icons mx-1">remove_circle_outline</i></div>
`+`<div style="align-self: flex-end;cursor:pointer;color:#657f8C"><i class="material-icons">info</i></div></div>`;$(u).insertBefore("#openRegistrationsDivider")}$("#openRegistrationsBadge").text(n.length)}function sendInvitations(n){const t=$("#mailRecipients").val().split(/[\n\r,;]+/);$.post({url:"SendInvitationMail",data:{votingId:n,addresses:t},success:function(){$("#inviteVotersModal").modal("hide")}})}function setupEditScreen(n){$(document).on("click",".dropdown-menu",function(n){n.stopPropagation()});updateRegistrations(n);$(".answerOptionText").click(function(){$(this).text()==="..."&&document.execCommand("selectAll",!1,null)});$(".answerOptionDescription").click(function(){$(this).text()==="..."&&document.execCommand("selectAll",!1,null)});$("#modalQuestionOk").off("click").on("click",function(){saveQuestion(n,0)});$(window).on("scroll",blinkOnScroll);$("#questionType").change(function(){$("#questionType").val()==="1"?($("#minNoAnswers").parent().hide(),$("#maxNoAnswers").parent().hide()):($("#minNoAnswers").parent().show(),$("#maxNoAnswers").parent().show())});$(".table-add").click(function(){const n=$("#answersTable").find("tr.hide").clone(!0).removeClass("hide table-line");n.addClass("answer-line");$("#answersTable").find("table").append(n)});$(".table-remove").click(function(){$(this).parents("tr.answer-line").detach()});$(".table-up").click(function(){const n=$(this).parents("tr");n.index()!==1&&n.prev().before(n.get(0))});$(".table-down").click(function(){const n=$(this).parents("tr");n.next().after(n.get(0))})}function blinkOnScroll(){const n=$(window).height()*1.1,t=$(window).scrollTop();$(".blinkOnScroll:not(.animated)").each(function(){var i=$(this),r=i.offset().top;t+n>r&&(i.data("timeout")?window.setTimeout(function(){i.addClass("animated blinky")},parseInt(i.data("timeout"),10)):i.addClass("animated blinky"))});$(".blinkOnScroll.animated").each(function(){const i=$(this),r=i.offset().top;t+n<r&&$(this).removeClass("animated blinky")})}function createQuestion(n){$("#newQuestionTitle").val("");$("#newQuestionDescription").val("");$("#newQuestionModal").modal();$("#modalQuestionOk").off("click").on("click",function(){saveQuestion(n,0)})}function showInviteModal(){$("#mailRecipients").val("");$("#inviteVotersModal").modal()}function setupOverview(){initApp();$("document").ready(function(){$("#fw-user-img-input").change(function(){previewAndUploadFile("user")});$("#fw-voting-img-input").change(function(){previewAndUploadFile("voting")});$("#fwStartDate").change(function(){fwValidate("#fwStartDate","#fwStartDateValidation",/^[0-3]?\d\.[0,1]?\d\.20\d{2}$/)});$("#fwEndDate").change(function(){fwValidate("#fwEndDate","#fwEndDateValidation",/^[0-3]?\d\.[0,1]?\d\.20\d{2}$/)});$("#fwStartTime").change(function(){fwValidate("#fwStartTime","#fwStartTimeValidation",/^[0-2]?\d:[0-5]\d$/)});$("#fwEndTime").change(function(){fwValidate("#fwEndTime","#fwEndTimeValidation",/^[0-2]?\d:[0-5]\d$/)});$("#fwNewVotingName").change(function(){fwValidate("#fwNewVotingName","#fwNewVotingNameValidation",/^(?!\s*$).+/)});showOverview();$("#fw-user-img-content").hover(function(){highlightImgSelector("user","rgba(255, 255, 255, 0.5)")},function(){resetImgSelector("user","rgba(255, 255, 255, 0.5)")});$("#fw-voting-img-content").hover(function(){highlightImgSelector("voting","rgba(101, 127, 140, 0.5)")},function(){resetImgSelector("voting","rgba(101, 127, 140, 0.5)")});$(".form-group.date").datepicker({format:"dd.mm.yyyy",autoclose:!0,language:"de",orientation:"top left"})})}function highlightImgSelector(n,t){$("#fw-"+n+"-img-selector").css("border","1px solid "+t);$("#fw-"+n+"-img-selector").css({backgroundColor:"rgba(0,0,0,.5)"});$("#fw-"+n+"-img-selector").css("box-shadow","1px 1px 1px rgba(0, 0, 0, 0.5)");$("#fw-"+n+"-img-icon").animate({fontSize:"1.5rem",color:"white"});$("#fw-"+n+"-img-text").animate({opacity:1})}function resetImgSelector(n,t){$("#fw-"+n+"-img-selector").css("border","0px solid "+t);$("#fw-"+n+"-img-selector").css({backgroundColor:"rgba(0,0,0,0)"});$("#fw-"+n+"-img-icon").animate({fontSize:"2rem"});$("#fw-"+n+"-img-text").animate({opacity:0});$("#fw-"+n+"-img-selector").css("box-shadow","0px 0px 0px");$("#fw-"+n+"-img-upload").css("display","none")}function highlightVotingCard(){console.log(this)}function showFileSelector(n){$(n).css("display","inline")}function highlightAddVoting(n){$(n).addClass("shadow-pulse")}function resetAddVoting(n){$(n).removeClass("shadow-pulse")}function createVoting(){$("#newVotingModal").modal()}function previewAndUploadFile(n){var r=$("#fw-"+n+"-img-input")[0].files[0],t,i;r.type.match(/image.*/)&&(t=new Image,i=new FileReader,i.onload=function(n){t.src=n.target.result},t.onload=function(){var u=document.getElementById("fw-"+n+"-img-real"),o=u.getContext("2d"),f=300,e=300,i=t.width,r=t.height;i>r?i>f&&(r*=f/i,i=f):r>e&&(i*=e/r,r=e);u.width=i;u.height=r;o.drawImage(t,0,0,i,r);$("#fw-"+n+"-img-dummy").hide();$("#fw-"+n+"-img-real").show();n==="user"&&uploadFile()},i.readAsDataURL(r))}function uploadFile(){var n=document.getElementById("fw-user-img-real"),t=n.toDataURL();$.ajax({url:"UpdateUserImage",type:"POST",data:{imageData:t},success:updateImage,error:function(){}})}function updateImage(){}function fwValidate(n,t,i){const r=$(n).val();return r.match(i)?($(n).removeClass("is-invalid"),$(t).removeClass("d-block"),!0):($(n).addClass("is-invalid"),$(t).addClass("d-block"),!1)}function saveVoting(){var r=$("#fwNewVotingName").val(),u=$("#fwNewVotingDescription").val(),t="",n=fwValidate("#fwStartDate","#fwStartDateValidation",/^[0-3]?\d\.[0,1]?\d\.20\d{2}$/),i;(n=fwValidate("#fwEndDate","#fwEndDateValidation",/^[0-3]?\d\.[0,1]?\d\.20\d{2}$/)&&n,n=fwValidate("#fwStartTime","#fwStartTimeValidation",/^[0-2]?\d:[0-5]\d$/)&&n,n=fwValidate("#fwEndTime","#fwEndTimeValidation",/^[0-2]?\d:[0-5]\d$/)&&n,n=fwValidate("#fwNewVotingName","#fwNewVotingNameValidation",/^(?!\s*$).+/)&&n,n)&&($("#fw-voting-img-real").is(":visible")&&(i=document.getElementById("fw-voting-img-real"),t=i.toDataURL()),$.post({url:"UpdateVoting",data:{title:r,desc:u,id:null,imageData:t,startDate:$("#fwStartDate").val(),startTime:$("#fwStartTime").val(),endDate:$("#fwEndDate").val(),endTime:$("#fwEndTime").val()},success:function(n){$("#newVotingModal").modal("hide");window.location.replace("Edit?id="+n)}}))}function showOverview(){console.log("showing overview...");$(".fw-open-voting").remove();$("#fw-add-voting-card").hide();$("#fw-load-votings-card").show();console.log("starting ajax");$.ajax({url:"GetVotingsForUser",type:"GET",datatype:"json",success:showOverviewData,error:function(n){console.log("oops, error");$("<div/>",{"class":"bc-error-message TODO TODO error handling",html:"An error occurred getting your votings: "+n}).appendTo("#votingOverviewListContent");componentHandler.upgradeDom();$("#fw-add-voting-card").show();$("#fw-load-votings-card").hide()}})}function showOverviewData(n){var i=[],t;for($("#fw-active-voting-count").text(n.length),t=0;t<n.length;t++){const r=n[t];let u='<div class="col-xl-4 col-md-6 col-12 fw-open-voting"><div class="card fw-overview-card">'+`<a href="Edit?id=${r.id}">`;u+=r.imageData?`<img class="card-img-top" style="max-height:12rem;" src="${r.imageData}">`:'<i class="material-icons fw-voting-img" style="text-align:center;width:100%">how_to_vote<\/i>';u+=`</a><div class="card-body d-flex flex-column justify-content-between" style="height:12rem"><h5 class="card-title">${r.title}</h5>`+`<p class="card-text">${truncate(r.description,50)}</p>
`+`<div><a class="fw-card-link-icon float-left p-2 border" href="javascript:void(0);" onclick="deleteVoting('${r.id}')"><i class="material-icons">delete</i></a>
`+`<a class="fw-card-link-icon bg-primary float-right p-2" href="Edit?id=${r.id}"><i class="material-icons text-white">edit</i></a></div></div></div></div>`;i.push(u)}$(i.join("\n")).insertBefore("#fw-add-voting-card");$("#fw-add-voting-card").show();$("#fw-load-votings-card").hide();componentHandler.upgradeDom();$(".fw-overview-card").mouseover(function(){$(this).removeClass("fw-overview-card-inactive");$(this).addClass("fw-overview-card-active")});$(".fw-overview-card").mouseout(function(){$(this).removeClass("fw-overview-card-active");$(this).addClass("fw-overview-card-inactive")})}function truncate(n,t){return n.length<t?n:n.substr(0,t)+"..."}function deleteVoting(n){confirm("Sind Sie sicher, dass Sie diese Abstimmung unwiderruflich löschen wollen?")&&$.post({url:"DeleteVoting",data:{id:n},success:function(){showOverview(firebase.auth().currentUser)}})}